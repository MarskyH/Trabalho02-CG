<!DOCTYPE html>
<html lang="en">

<head>
	<title>Animação Batalha Naval - Three.js</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>

	<div id="container"></div>
	<div id="info">
		<a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - webgl ocean
	</div>

	<script type="importmap">
			{
				"imports": {
					"three": "../build/three.module.js",
					"three/addons/": "./jsm/"
				}
			}
		</script>

	<script type="module">

		import * as THREE from 'three';

		import Stats from 'three/addons/libs/stats.module.js';

		import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		import { Water } from 'three/addons/objects/Water.js';
		import { Sky } from 'three/addons/objects/Sky.js';
		import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

		let container, stats;
		let camera, scene, renderer;
		let controls, water, sun, mesh;
		let us_battleship_louisiana;

		const modelLoader = new GLTFLoader();

		init();
		animate();

		function init() {


			container = document.getElementById('container');

			//

			renderer = new THREE.WebGLRenderer();
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.useLegacyLights = false;
			renderer.toneMapping = THREE.ACESFilmicToneMapping;
			renderer.toneMappingExposure = 0.4;
			container.appendChild(renderer.domElement);

			//

			scene = new THREE.Scene();

			camera = new THREE.PerspectiveCamera(100, window.innerWidth / window.innerHeight, 1, 20000);
			camera.position.set(100, 0, 100);

			//

			sun = new THREE.Vector3();

			// Water

			const waterGeometry = new THREE.PlaneGeometry(10000, 10000);

			water = new Water(
				waterGeometry,
				{
					textureWidth: 512,
					textureHeight: 512,
					waterNormals: new THREE.TextureLoader().load('textures/waternormals.jpg', function (texture) {

						texture.wrapS = texture.wrapT = THREE.RepeatWrapping;

					}),
					sunDirection: new THREE.Vector3(),
					sunColor: 0xFF8E38,
					waterColor: 0x001e0f,
					distortionScale: 3.7,
					fog: scene.fog !== undefined
				}
			);

			water.rotation.x = - Math.PI / 2;

			scene.add(water);

			// Skybox

			const sky = new Sky();
			sky.scale.setScalar(10000);
			scene.add(sky);

			const skyUniforms = sky.material.uniforms;

			skyUniforms['turbidity'].value = 10;
			skyUniforms['rayleigh'].value = 2;
			skyUniforms['mieCoefficient'].value = 0.005;
			skyUniforms['mieDirectionalG'].value = 0.8;

			const parameters = {
				elevation: 2,
				azimuth: 180
			};

			const pmremGenerator = new THREE.PMREMGenerator(renderer);
			let renderTarget;

			function updateSun() {

				const phi = THREE.MathUtils.degToRad(90 - parameters.elevation);
				const theta = THREE.MathUtils.degToRad(parameters.azimuth);

				sun.setFromSphericalCoords(1, phi, theta);

				sky.material.uniforms['sunPosition'].value.copy(sun);
				water.material.uniforms['sunDirection'].value.copy(sun).normalize();

				if (renderTarget !== undefined) renderTarget.dispose();

				renderTarget = pmremGenerator.fromScene(sky);

				scene.environment = renderTarget.texture;

			}

			updateSun();

			//

			const geometry = new THREE.BoxGeometry(30, 30, 30);
			const material = new THREE.MeshStandardMaterial({ roughness: 0 });



			//
			controls = new OrbitControls(camera, renderer.domElement);
			controls.maxPolarAngle = Math.PI * 0.495;
			controls.target.set(0, 10, 0);
			controls.minDistance = 40.0;
			controls.maxDistance = 200.0;
			controls.update();

			//

			stats = new Stats();
			container.appendChild(stats.dom);

			// GUI

			const gui = new GUI();

			const folderSky = gui.addFolder('Sky');
			folderSky.add(parameters, 'elevation', 0, 90, 0.1).onChange(updateSun);
			folderSky.add(parameters, 'azimuth', - 180, 180, 0.1).onChange(updateSun);
			folderSky.open();

			const waterUniforms = water.material.uniforms;

			const folderWater = gui.addFolder('Water');
			folderWater.add(waterUniforms.distortionScale, 'value', 0, 8, 0.1).name('distortionScale');
			folderWater.add(waterUniforms.size, 'value', 0.1, 10, 0.1).name('size');
			folderWater.open();

			//

			window.addEventListener('resize', onWindowResize);


			let us_battleship_louisiana;

			// Dentro da função de carregamento do modelo us_battleship_louisiana
			modelLoader.load('models/us_battleship_louisiana/scene.gltf', function (gltf) {
				us_battleship_louisiana = gltf.scene;
				us_battleship_louisiana.scale.set(3, 8, 3);
				us_battleship_louisiana.position.set(0, 0, 0);
				// Obtém a lista de texturas da pasta "textures"
				const texturePath = 'models/us_battleship_louisiana/textures/';
				const textureFiles = ['Material_2677_0_diffuse.png',
					'Material_2677_diffuse.png',]
				/*const textureFiles = [
					'Chikugo-class_material_20_8_0_specularGlossiness.jpeg',
					'Chikugo-class_material_20_8_diffuse.jpeg',
					'Chikugo-class_material_20_8_specularGlossiness.jpeg',
					'Chikugo-class_material_22_8_diffuse.jpeg',
					'Chikugo-class_material_22_8_specularGlossiness.jpeg',
					'Chikugo-class_material_8_8_diffuse.png',
					'Chikugo-class_material_8_8_specularGlossiness.jpeg',
					'Chikugo-class_material_20_8_0_diffuse.jpeg',
					'Material_2677_0_diffuse.png',
					'Material_2677_diffuse.png',
					'Ohio_am433_mc_box_246_0_diffuse.png',
					'Ohio_am433_mc_box_246_1_diffuse.jpeg',
					'Ohio_am433_mc_box_246_10_diffuse.jpeg',
					'Ohio_am433_mc_box_246_11_diffuse.jpeg',
					'Ohio_am433_mc_box_246_12_diffuse.jpeg',
					'Ohio_am433_mc_box_246_13_diffuse.jpeg',
					'Ohio_am433_mc_box_246_14_diffuse.jpeg',
					'Ohio_am433_mc_box_246_15_diffuse.png',
					'Ohio_am433_mc_box_246_16_diffuse.jpeg',
					'Ohio_am433_mc_box_246_17_diffuse.png',
					'Ohio_am433_mc_box_246_18_diffuse.jpeg',
					'Ohio_am433_mc_box_246_19_diffuse.jpeg',
					'Ohio_am433_mc_box_246_2_diffuse.jpeg',
					'Ohio_am433_mc_box_246_20_diffuse.jpeg',
					'Ohio_am433_mc_box_246_21_diffuse.jpeg',
					'Ohio_am433_mc_box_246_22_diffuse.jpeg',
					'Ohio_am433_mc_box_246_23_diffuse.jpeg',
					'Ohio_am433_mc_box_246_24_diffuse.jpeg',
					'Ohio_am433_mc_box_246_25_diffuse.jpeg',
					'Ohio_am433_mc_box_246_26_diffuse.jpeg',
					'Ohio_am433_mc_box_246_27_diffuse.jpeg',
					'Ohio_am433_mc_box_246_28_diffuse.jpeg',
					'Ohio_am433_mc_box_246_29_diffuse.jpeg',
					'Ohio_am433_mc_box_246_3_diffuse.jpeg',
					'Ohio_am433_mc_box_246_30_diffuse.jpeg',
					'Ohio_am433_mc_box_246_31_diffuse.jpeg',
					'Ohio_am433_mc_box_246_32_diffuse.jpeg',
					'Ohio_am433_mc_box_246_33_diffuse.jpeg',
					'Ohio_am433_mc_box_246_34_diffuse.jpeg',
					'Ohio_am433_mc_box_246_35_diffuse.jpeg',
					'Ohio_am433_mc_box_246_36_diffuse.jpeg',
					'Ohio_am433_mc_box_246_37_diffuse.jpeg',
					'Ohio_am433_mc_box_246_38_diffuse.jpeg',
					'Ohio_am433_mc_box_246_39_diffuse.jpeg',
					'Ohio_am433_mc_box_246_4_diffuse.jpeg',
					'Ohio_am433_mc_box_246_40_diffuse.jpeg',
					'Ohio_am433_mc_box_246_41_diffuse.jpeg',
					'Ohio_am433_mc_box_246_42_diffuse.jpeg',
					'Ohio_am433_mc_box_246_43_diffuse.jpeg',
					'Ohio_am433_mc_box_246_44_diffuse.jpeg',
					'Ohio_am433_mc_box_246_45_diffuse.jpeg',
					'Ohio_am433_mc_box_246_46_diffuse.jpeg',
					'Ohio_am433_mc_box_246_47_diffuse.jpeg',
					'Ohio_am433_mc_box_246_48_diffuse.jpeg',
					'Ohio_am433_mc_box_246_49_diffuse.jpeg',
					'Ohio_am433_mc_box_246_5_diffuse.jpeg',
					'Ohio_am433_mc_box_246_50_diffuse.jpeg',
					'Ohio_am433_mc_box_246_51_diffuse.jpeg',
					'Ohio_am433_mc_box_246_52_diffuse.jpeg',
					'Ohio_am433_mc_box_246_53_diffuse.jpeg',
					'Ohio_am433_mc_box_246_54_diffuse.jpeg',
					'Ohio_am433_mc_box_246_55_diffuse.jpeg',
					'Ohio_am433_mc_box_246_56_diffuse.jpeg',
					'Ohio_am433_mc_box_246_57_diffuse.jpeg',
					'Ohio_am433_mc_box_246_58_diffuse.jpeg',
					'Ohio_am433_mc_box_246_59_diffuse.jpeg',
					'Ohio_am433_mc_box_246_6_diffuse.jpeg',
					'Ohio_am433_mc_box_246_60_diffuse.jpeg',
					'Ohio_am433_mc_box_246_61_diffuse.jpeg',
					'Ohio_am433_mc_box_246_62_diffuse.jpeg',
					'Ohio_am433_mc_box_246_63_diffuse.jpeg',
					'Ohio_am433_mc_box_246_64_diffuse.jpeg',
					'Ohio_am433_mc_box_246_65_diffuse.jpeg',
					'Ohio_am433_mc_box_246_66_diffuse.jpeg',
					'Ohio_am433_mc_box_246_67_diffuse.jpeg',
					'Ohio_am433_mc_box_246_68_diffuse.jpeg',
					'Ohio_am433_mc_box_246_69_diffuse.jpeg',
					'Ohio_am433_mc_box_246_7_diffuse.jpeg',
					'Ohio_am433_mc_box_246_70_diffuse.jpeg',
					'Ohio_am433_mc_box_246_71_diffuse.jpeg',
					'Ohio_am433_mc_box_246_72_diffuse.jpeg',
					'Ohio_am433_mc_box_246_73_diffuse.jpeg',
					'Ohio_am433_mc_box_246_74_diffuse.jpeg',
					'Ohio_am433_mc_box_246_75_diffuse.jpeg',
					'Ohio_am433_mc_box_246_76_diffuse.png',
					'Ohio_am433_mc_box_246_77_diffuse.jpeg',
					'Ohio_am433_mc_box_246_78_diffuse.jpeg',
					'Ohio_am433_mc_box_246_79_diffuse.jpeg',
					'Ohio_am433_mc_box_246_8_diffuse.jpeg',
					'Ohio_am433_mc_box_246_80_diffuse.jpeg',
					'Ohio_am433_mc_box_246_81_diffuse.jpeg',
					'Ohio_am433_mc_box_246_82_diffuse.jpeg',
					'Ohio_am433_mc_box_246_83_diffuse.jpeg',
					'Ohio_am433_mc_box_246_84_diffuse.jpeg',
					'Ohio_am433_mc_box_246_9_diffuse.jpeg',
					'Ohio_am433_mc_box_246_diffuse.jpeg',
				];
*/
				us_battleship_louisiana.traverse(function (object) {
					if (object.isMesh) {
						// Verifique se o objeto possui um material
						if (object.material) {
							object.material.roughness = 0.1
							// Percorra cada arquivo de textura
							for (const textureFile of textureFiles) {
								// Construa o caminho completo da textura
								const textureFilePath = texturePath + textureFile;

								// Carregue a textura
								const texture = new THREE.TextureLoader().load(textureFilePath);

								// Crie um novo material com a textura carregada
								const material = new THREE.MeshStandardMaterial({ map: texture });

								// Atribua o novo material ao objeto
								object.material = material.clone();
							}
						}
					}
				});
				scene.add(us_battleship_louisiana)
			});

				modelLoader.load('models/free_sandy_rock_hill/scene.gltf', function (gltf) {
					const model = gltf.scene;

					// Ajuste a posição do modelo
					model.position.set(0, 8, 0);

					// Ajuste a escala do modelo (se necessário)
					model.scale.set(1, 1, 1);

					// Ajuste a rotação do modelo (se necessário)
					model.rotation.set(0, Math.PI, 0);

					// Percorra todos os materiais do modelo e adicione texturas
					model.traverse(function (object) {
						if (object.isMesh) {
							// Verifique se o objeto possui um material
							if (object.material) {
								object.material.roughness = 0.4
								// Verifique se o material possui uma textura
								if (object.material.map) {
									// Obtenha o nome do arquivo da textura atual
									const textureFile = object.material.map.sourceFile;

									// Construa o caminho completo da textura
									const texturePath = 'models/free_sandy_rock_hill/textures/' + textureFile;

									// Carregue a textura
									const texture = new THREE.TextureLoader().load(texturePath);

									// Crie um novo material com a textura carregada
									const material = new THREE.MeshStandardMaterial({ map: texture });

									// Atribua o novo material ao objeto
									object.material = material;
								}
							}
						}
					});

					scene.add(model); // Adicione o modelo à cena do three.js
				});




			}

		function onWindowResize() {

					camera.aspect = window.innerWidth / window.innerHeight;
					camera.updateProjectionMatrix();

					renderer.setSize(window.innerWidth, window.innerHeight);

				}

		function animate() {

					requestAnimationFrame(animate);
					render();
					stats.update();

				}

		function render() {

					const time = performance.now() * 0.001;



					water.material.uniforms['time'].value += 1.0 / 60.0;

					renderer.render(scene, camera);

				}

	</script>
</body>

</html>